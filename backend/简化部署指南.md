# 简化部署指南（不使用OSS）

## 适用场景

- 轻量应用服务器（2核2GB）
- 数据量不大（< 1GB）
- 想省钱，不想买OSS
- 想配置简单

## 部署步骤

### 步骤1：上传文件到服务器

```bash
cd /Users/liuwenlin/Documents/Self/CookingApp2/backend
scp simple-server.js package.json root@47.112.167.11:/opt/cooking-app-backend
```

### 步骤2：连接到服务器

```bash
ssh root@47.112.167.11
```

### 步骤3：安装 Node.js

```bash
# 安装 Node.js 18
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs

# 检查版本
node -v
npm -v
```

### 步骤4：安装依赖

```bash
cd /opt/cooking-app-backend
npm install express axios cors
```

### 步骤5：安装 PM2（进程管理器）

```bash
sudo npm install -g pm2
```

### 步骤6：创建配置文件

```bash
nano /opt/cooking-app-backend/.env
```

填入以下内容（只需要微信小程序信息）：

```env
# 服务器配置
PORT=3000
NODE_ENV=production
DATA_DIR=/opt/cooking-app-backend/data

# 微信小程序配置（必须）
WX_APP_ID=你的小程序AppID
WX_APP_SECRET=你的小程序AppSecret
```

**只需要提供：**
- 小程序AppID
- 小程序AppSecret

**不需要OSS相关配置！**

### 步骤7：启动服务

```bash
cd /opt/cooking-app-backend
pm2 start simple-server.js --name cooking-app-backend
pm2 save
pm2 startup
```

### 步骤8：配置防火墙

```bash
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --reload
```

### 步骤9：测试服务

```bash
curl http://47.112.167.11:3000/health
```

应该返回：
```json
{"success":true,"message":"服务运行正常","timestamp":"...","storage":"本地存储"}
```

### 步骤10：配置小程序

编辑 `utils/cloudStorage.js`：

```javascript
const config = {
  apiBaseUrl: 'http://47.112.167.11:3000/api'
};
```

## 数据存储位置

数据存储在服务器本地：
```
/opt/cooking-app-backend/data/users/{openid}/
  ├── shopInfo.json
  ├── recipes.json
  ├── orders.json
  └── categories.json
```

## 备份建议

虽然数据存在服务器上，但建议定期备份：

```bash
# 备份数据目录
tar -czf backup-$(date +%Y%m%d).tar.gz /opt/cooking-app-backend/data

# 下载到本地
scp root@47.112.167.11:/opt/cooking-app-backend/backup-*.tar.gz ./
```

## 常用命令

```bash
# 查看服务状态
pm2 status

# 查看日志
pm2 logs cooking-app-backend

# 重启服务
pm2 restart cooking-app-backend

# 查看数据目录大小
du -sh /opt/cooking-app-backend/data
```

## 优势

✅ **简单**：不需要OSS配置  
✅ **省钱**：不需要OSS费用  
✅ **够用**：对于小程序数据量完全够用  
✅ **快速**：数据直接存在服务器，访问快  

## 注意事项

⚠️ **定期备份**：服务器重装系统，数据会丢失  
⚠️ **监控空间**：注意系统盘空间使用情况  
⚠️ **数据安全**：建议定期备份重要数据  
