<!--pages/kitchen/kitchen.wxml-->
<view class="kitchen-page">
  <!-- é¡¶éƒ¨åº—é“ºä¿¡æ¯ -->
  <view class="header-section">
    <image class="header-bg" src="{{shopInfo.background || '/images/default-bg.jpg'}}" mode="aspectFill"></image>
    <view class="shop-info">
      <view class="shop-header">
        <view class="shop-left">
          <image class="shop-avatar" src="{{shopInfo.avatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="shop-details">
            <text class="shop-name">{{shopInfo.name || 'æˆ‘çš„å°åº—'}}</text>
            <text class="kitchen-name" wx:if="{{currentKitchen}}">{{currentKitchen.name}} Â· å…±{{filteredRecipes.length}}ä¸ªèœè°±</text>
            <text class="kitchen-name" wx:else>åŠ è½½ä¸­...</text>
            <text class="shop-intro" wx:if="{{shopInfo.intro}}">{{shopInfo.intro}}</text>
          </view>
        </view>
        <view class="shop-right">
          <view class="icon-btn" bindtap="switchKitchen">
            <text class="iconfont">ğŸ </text>
          </view>
          <view class="icon-btn" bindtap="goToSettings">
            <text class="iconfont">âš™ï¸</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-tabs">
      <view class="nav-tab {{mode === 'order' ? 'active' : ''}}" data-mode="order" bindtap="switchMode">
        <text>ç‚¹å•</text>
      </view>
      <view class="nav-tab {{mode === 'edit' ? 'active' : ''}}" data-mode="edit" bindtap="switchMode" wx:if="{{isAdmin}}">
        <text>ç¼–è¾‘</text>
      </view>
    </view>
    <view class="nav-actions">
      <view class="action-btn" bindtap="addRecipe" wx:if="{{mode === 'edit' || isAdmin}}">
        <text>æ·»åŠ èœè°±</text>
      </view>
      <view class="action-btn search-btn" bindtap="showSearchInput">
        <text>ğŸ” æœç´¢</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-box" wx:if="{{showSearch}}">
    <input class="search-input" placeholder="æœç´¢èœåã€æè¿°ã€åˆ†ç±»" value="{{searchKeyword}}" bindinput="onSearchInput" />
    <view class="search-close" bindtap="hideSearch">âœ•</view>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="content-section">
    <view class="category-sidebar">
      <view class="category-item {{selectedCategory === 'all' ? 'active' : ''}}" data-id="all" bindtap="selectCategory">
        <text>å…¨éƒ¨</text>
      </view>
      <view class="category-item {{selectedCategory === item.id ? 'active' : ''}}" 
            wx:for="{{categories}}" 
            wx:key="id"
            data-id="{{item.id}}" 
            bindtap="selectCategory">
        <text>{{item.icon}} {{item.name}}</text>
      </view>
    </view>

    <view class="recipe-list">
      <view class="recipe-card" wx:for="{{filteredRecipes}}" wx:key="id" data-id="{{item.id}}" bindtap="goToDetail">
        <image class="recipe-image" src="{{item.image || '/images/default-recipe.png'}}" mode="aspectFill" binderror="onImageError" data-id="{{item.id}}"></image>
        <view class="recipe-info">
          <view class="recipe-header">
            <text class="recipe-name">{{item.name}}</text>
            <text class="must-have-tag" wx:if="{{item.isMustHave}}">å¿…ç‚¹</text>
          </view>
          <view class="recipe-meta">
            <text class="recipe-rating">â­ {{item.rating || 0}}</text>
            <text class="recipe-sales">æœˆé”€{{item.monthlySales || 0}}</text>
          </view>
          <view class="recipe-footer">
            <view class="recipe-tags">
              <text class="tag" wx:if="{{item.difficulty}}">{{item.difficulty}}</text>
              <text class="tag" wx:if="{{item.duration}}">{{item.duration}}åˆ†é’Ÿ</text>
            </view>
            <view class="add-btn" catchtap="addToCart" data-id="{{item.id}}" wx:if="{{mode === 'order'}}">
              <text>+</text>
            </view>
            <view class="edit-actions" wx:if="{{mode === 'edit' && isAdmin}}">
              <view class="edit-btn" catchtap="editRecipe" data-id="{{item.id}}">ç¼–è¾‘</view>
              <view class="delete-btn" catchtap="deleteRecipe" data-id="{{item.id}}">åˆ é™¤</view>
            </view>
          </view>
        </view>
      </view>
      <view class="empty" wx:if="{{filteredRecipes.length === 0 && !searchKeyword}}">
        <text class="empty-icon">ğŸ½ï¸</text>
        <text class="empty-text">æš‚æ— èœè°±</text>
        <text class="empty-tip" wx:if="{{isAdmin}}">ç‚¹å‡»"æ·»åŠ èœè°±"å¼€å§‹æ·»åŠ å§</text>
      </view>
      <view class="empty" wx:if="{{filteredRecipes.length === 0 && searchKeyword}}">
        <text class="empty-icon">ğŸ”</text>
        <text class="empty-text">æœªæ‰¾åˆ°ç›¸å…³èœè°±</text>
        <text class="empty-tip">è¯•è¯•å…¶ä»–å…³é”®è¯</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar" wx:if="{{mode === 'order'}}">
    <view class="cart-icon" bindtap="goToCart">
      <text class="icon">ğŸ›’</text>
      <text class="cart-count" wx:if="{{cartCount > 0}}">{{cartCount}}</text>
    </view>
    <view class="action-buttons">
      <view class="invite-btn" bindtap="inviteOrder">é‚€è¯·ä¸‹å•</view>
      <view class="order-btn {{cartCount > 0 ? 'active' : ''}}" bindtap="goToCart">ä¸‹å•</view>
    </view>
  </view>
</view>
