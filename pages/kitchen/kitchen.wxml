<!--pages/kitchen/kitchen.wxml-->
<view class="kitchen-page">
  <!-- é¡¶éƒ¨åº—é“ºä¿¡æ¯ -->
  <view class="header-section">
    <!-- â­ ä¿®å¤ï¼šç®€åŒ–æ¡ä»¶åˆ¤æ–­ï¼Œç¡®ä¿å§‹ç»ˆæœ‰å†…å®¹æ˜¾ç¤º -->
    <view class="header-bg no-bg" wx:if="{{!shopInfo || !shopInfo.background}}"></view>
    <view class="header-bg" wx:else>
      <image src="{{shopInfo.background}}" mode="aspectFill" style="width: 100%; height: 100%;"></image>
    </view>
    <view class="shop-info">
      <view class="shop-header">
        <view class="shop-left">
          <!-- â­ ä¿®å¤ï¼šç¡®ä¿å¤´åƒå§‹ç»ˆæ˜¾ç¤º -->
          <view class="shop-avatar no-avatar" wx:if="{{!shopInfo || !shopInfo.avatar}}">
            <text style="font-size: 48rpx;">ğŸª</text>
          </view>
          <view class="shop-avatar" wx:else>
            <image src="{{shopInfo.avatar}}" mode="aspectFill" style="width: 100%; height: 100%;"></image>
          </view>
          <view class="shop-details">
            <text class="shop-name">{{shopInfo ? (shopInfo.name || 'æˆ‘çš„å°åº—') : 'æˆ‘çš„å°åº—'}}</text>
            <text class="kitchen-name">{{currentKitchen ? (currentKitchen.name || 'ä¸»å¨æˆ¿') : 'ä¸»å¨æˆ¿'}} Â· å…±{{filteredRecipes ? filteredRecipes.length : 0}}ä¸ªèœè°±</text>
            <text class="shop-intro" wx:if="{{shopInfo && shopInfo.intro}}">{{shopInfo.intro}}</text>
          </view>
        </view>
        <view class="shop-right">
          <view class="icon-btn" bindtap="switchKitchen">
            <text class="iconfont">ğŸ </text>
          </view>
          <view class="icon-btn" bindtap="goToSettings">
            <text class="iconfont">âš™ï¸</text>
          </view>
        </view>
      </view>
      
      <!-- æœªç™»å½•æç¤º -->
      <view class="login-hint" wx:if="{{!userInfo}}">
        <text>ğŸ“Œ ç‚¹å‡»å³ä¸‹è§’ã€Œæˆ‘çš„ã€ç™»å½•åä½¿ç”¨å®Œæ•´åŠŸèƒ½</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-tabs">
      <view class="nav-tab {{mode === 'order' ? 'active' : ''}}" data-mode="order" bindtap="switchMode">
        <text>ç‚¹å•</text>
      </view>
      <view class="nav-tab {{mode === 'edit' ? 'active' : ''}}" data-mode="edit" bindtap="switchMode" wx:if="{{isAdmin}}">
        <text>ç¼–è¾‘</text>
      </view>
    </view>
    <view class="nav-actions">
      <view class="action-btn {{!isAdmin ? 'disabled' : ''}}" bindtap="addRecipe" wx:if="{{isAdmin}}">
        <text>â• æ·»åŠ èœè°±</text>
      </view>
      <view class="action-btn search-btn" bindtap="showSearchInput">
        <text>ğŸ” æœç´¢</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-box" wx:if="{{showSearch}}">
    <input class="search-input" placeholder="æœç´¢èœåã€æè¿°ã€åˆ†ç±»" value="{{searchKeyword}}" bindinput="onSearchInput" />
    <view class="search-close" bindtap="hideSearch">âœ•</view>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="content-section">
    <view class="category-sidebar">
      <view class="category-item {{selectedCategory === 'all' ? 'active' : ''}}" data-id="all" bindtap="selectCategory">
        <text>å…¨éƒ¨</text>
      </view>
      <view class="category-item {{selectedCategory === item.id ? 'active' : ''}}" 
            wx:for="{{categories}}" 
            wx:key="id"
            wx:for-item="item"
            data-id="{{item.id}}" 
            bindtap="selectCategory">
        <text>{{item.name}}</text>
      </view>
    </view>

    <view class="recipe-list">
      <view class="recipe-card" wx:for="{{filteredRecipes}}" wx:key="id" wx:for-item="item" data-id="{{item.id}}" bindtap="goToDetail">
        <image class="recipe-image {{item.image ? '' : 'no-image'}}" src="{{item.image || ''}}" mode="aspectFill" binderror="onImageError" data-id="{{item.id}}"></image>
        <view class="recipe-info">
          <view class="recipe-header">
            <text class="recipe-name">{{item.name}}</text>
            <text class="must-have-tag" wx:if="{{item.isMustHave}}">å¿…ç‚¹</text>
          </view>
          <view class="recipe-meta">
            <text class="recipe-rating">â­ {{item.rating || 0}}</text>
            <text class="recipe-sales">æœˆé”€{{item.monthlySales || 0}}</text>
          </view>
          <view class="recipe-footer">
            <view class="recipe-tags">
              <text class="tag" wx:if="{{item.difficulty}}">{{item.difficulty}}</text>
              <text class="tag" wx:if="{{item.duration}}">{{item.duration}}åˆ†é’Ÿ</text>
            </view>
            <view class="add-btn" catchtap="addToCart" data-id="{{item.id}}" wx:if="{{mode === 'order'}}" style="z-index: 999;">
              <text>+</text>
            </view>
            <view class="edit-actions" wx:if="{{mode === 'edit' && isAdmin}}">
              <view class="edit-btn" catchtap="editRecipe" data-id="{{item.id}}">ç¼–è¾‘</view>
              <view class="delete-btn" catchtap="deleteRecipe" data-id="{{item.id}}">åˆ é™¤</view>
            </view>
          </view>
        </view>
      </view>
      <view class="empty" wx:if="{{(!filteredRecipes || filteredRecipes.length === 0) && !searchKeyword}}">
        <text class="empty-icon">ğŸ½ï¸</text>
        <text class="empty-text">æš‚æ— èœè°±</text>
        <text class="empty-tip">ç‚¹å‡»å³ä¸Šè§’"æ·»åŠ èœè°±"å¼€å§‹æ·»åŠ å§</text>
        <view class="empty-action" wx:if="{{isAdmin}}" bindtap="addRecipe">
          <text>ç«‹å³æ·»åŠ </text>
        </view>
        <text class="empty-tip" wx:if="{{!isAdmin}}" style="color: #999; font-size: 22rpx; margin-top: 10rpx;">
          æç¤ºï¼šéœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½æ·»åŠ èœè°±
        </text>
      </view>
      <view class="empty" wx:if="{{(!filteredRecipes || filteredRecipes.length === 0) && searchKeyword}}">
        <text class="empty-icon">ğŸ”</text>
        <text class="empty-text">æœªæ‰¾åˆ°ç›¸å…³èœè°±</text>
        <text class="empty-tip">è¯•è¯•å…¶ä»–å…³é”®è¯</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar" wx:if="{{mode === 'order'}}">
    <view class="cart-icon" bindtap="goToCart">
      <text class="icon">ğŸ›’</text>
      <text class="cart-count" wx:if="{{cartCount > 0}}">{{cartCount}}</text>
    </view>
    <view class="action-buttons">
      <view class="invite-btn" bindtap="inviteOrder">é‚€è¯·ä¸‹å•</view>
      <view class="order-btn {{cartCount > 0 ? 'active' : ''}}" bindtap="goToCart">ä¸‹å•</view>
    </view>
  </view>
</view>
