# 邀请下单功能使用说明

## 📱 功能简介

邀请下单功能允许您将购物车中的菜品分享给好友，好友收到分享后可以查看并确认下单，实现多人协作点餐。

## 🎯 使用场景

- **情侣点餐**：一人选好菜品，分享给另一半确认
- **家庭聚餐**：家长选好菜品，分享给家人一起确认
- **朋友聚餐**：组织者选好菜品，分享给朋友查看和补充

## 📋 使用步骤

### 第一步：添加菜品到购物车

1. 在厨房页面浏览菜谱
2. 点击菜品卡片上的 **"+"** 按钮，将菜品加入购物车
3. 可以添加多个菜品，调整数量

### 第二步：点击"邀请下单"按钮

1. 在页面底部操作栏，找到 **"邀请下单"** 按钮（紫色边框）
2. 点击按钮

### 第三步：选择分享方式

系统会弹出三个选项：

#### 方式一：分享给微信好友（推荐）

1. 选择 **"分享给微信好友"**
2. 按照提示，点击右上角 **"..."** 按钮
3. 选择 **"转发"**
4. 选择要分享的微信好友或群聊
5. 好友点击分享卡片后，会自动打开小程序并加载购物车

**优点**：
- ✅ 最便捷的分享方式
- ✅ 好友点击即可直接查看
- ✅ 自动加载购物车内容

#### 方式二：生成分享图片

1. 选择 **"生成分享图片"**
2. 系统会将订单信息复制到剪贴板
3. 打开微信，粘贴发送给好友

**分享内容格式**：
```
🍽️ 邀请您一起点餐

📍 我的厨房

📋 已选菜品：
1. 红烧肉 x2  ¥60.00
2. 宫保鸡丁 x1  ¥35.00

💰 总计：¥95.00

请打开小程序查看并确认下单
```

#### 方式三：复制分享链接

1. 选择 **"复制分享链接"**
2. 系统会将完整分享信息（含小程序路径）复制到剪贴板
3. 打开微信，粘贴发送给好友

## 📥 接收分享

### 当好友收到分享时

#### 情况一：通过微信分享卡片进入

1. 好友点击分享卡片
2. 自动打开小程序
3. 如果购物车为空，系统会提示：
   ```
   收到分享订单
   好友邀请您一起点餐，共X个菜品，总计¥XX.XX
   是否加入购物车？
   ```
4. 点击 **"确定"**，购物车会自动加载分享的菜品
5. 自动跳转到购物车页面，可以查看和修改

#### 情况二：通过复制的内容进入

1. 好友打开小程序
2. 如果分享链接包含参数，系统会自动识别并加载购物车

### 厨房不匹配处理

如果分享的订单来自其他厨房，系统会提示：

```
厨房不匹配
分享的订单来自"厨房A"，当前在"厨房B"
是否切换到该厨房？
```

- 点击 **"确定"**：自动切换到分享的厨房，并加载购物车
- 点击 **"取消"**：保持当前厨房，不加载购物车

## 🔄 购物车合并逻辑

### 相同厨房

- 如果当前购物车属于同一厨房，分享的菜品会**合并**到购物车
- 相同菜品会**累加数量**
- 不同菜品会**追加**到购物车

### 不同厨房

- 如果当前购物车属于其他厨房，会先**清空**当前购物车
- 然后加载分享的购物车

## ⚠️ 注意事项

### 1. 购物车为空时

如果购物车为空，点击"邀请下单"会提示：
```
购物车为空
请先添加菜品到购物车，再邀请他人下单
```

### 2. 分享数据有效期

- 分享数据会包含时间戳
- 建议在24小时内使用分享链接
- 过期后可能需要重新分享

### 3. 菜品信息

- 分享的菜品信息包括：菜名、数量、单价、总价
- 如果菜品被删除，接收时可能无法加载
- 建议分享后尽快让好友确认下单

### 4. 权限说明

- 任何人都可以分享购物车
- 接收分享后，任何人都可以查看和下单
- 不需要管理员权限

## 💡 使用技巧

### 技巧一：先选好基础菜品

在分享前，先选好大家都需要的菜品（如主食、汤类），再分享给其他人补充。

### 技巧二：分批分享

如果菜品较多，可以分多次分享，每次分享不同类型的菜品。

### 技巧三：群聊分享

在家庭群或朋友群中分享，让大家一起查看和讨论。

### 技巧四：确认后下单

收到分享后，建议先查看购物车，确认无误后再下单。

## 🎨 界面说明

### 邀请下单按钮

- **位置**：页面底部操作栏，左侧
- **样式**：紫色边框，白色背景
- **文字**：邀请下单

### 下单按钮

- **位置**：页面底部操作栏，右侧
- **样式**：
  - 购物车为空：灰色背景
  - 购物车有商品：紫色背景（active状态）
- **文字**：下单

## 🔧 技术说明

### 分享数据格式

```json
{
  "type": "invite_order",
  "kitchenId": "kitchen_123",
  "kitchenName": "我的厨房",
  "cart": [
    {
      "recipeId": "recipe_456",
      "recipeName": "红烧肉",
      "recipeImage": "https://...",
      "price": 30.00,
      "quantity": 2
    }
  ],
  "totalPrice": 60.00,
  "timestamp": 1234567890
}
```

### 分享参数传递

- 通过小程序路径参数传递：`/pages/kitchen/kitchen?share=编码后的数据`
- 数据经过 URL 编码，确保特殊字符正确处理

## ❓ 常见问题

### Q1: 分享后好友看不到菜品？

**可能原因**：
- 好友的小程序版本过旧
- 分享数据格式错误
- 网络问题

**解决方法**：
- 让好友更新小程序
- 重新分享
- 检查网络连接

### Q2: 分享的菜品价格不对？

**说明**：
- 分享时使用的是当前价格
- 如果菜品价格更新，分享链接中的价格不会变化
- 建议分享后尽快确认下单

### Q3: 可以分享给多少人？

**说明**：
- 理论上可以分享给任意多人
- 建议每次分享给1-3人，避免混乱
- 多人可以分别分享，最后统一确认

### Q4: 分享后可以修改购物车吗？

**说明**：
- 分享后，您可以继续修改自己的购物车
- 好友接收的购物车是分享时的快照
- 修改不会影响已分享的内容

## 🎉 总结

邀请下单功能让点餐变得更加便捷和协作化。无论是情侣、家庭还是朋友聚餐，都可以轻松分享和确认订单，让"今天吃什么"不再是难题！
