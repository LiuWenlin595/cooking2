# 登录问题排查指南

## 问题现象

点击登录按钮后，没有弹出授权弹窗，直接获取到"微信用户"的默认信息。

## 可能的原因

### 1. 在开发者工具中测试
- **现象**：开发者工具可能不会弹出授权弹窗，直接返回模拟数据
- **解决**：**必须在真机上测试登录功能**

### 2. 基础库版本问题
- **现象**：某些基础库版本可能不支持 `wx.getUserProfile`
- **解决**：
  1. 在开发者工具中：工具栏 → 详情 → 本地设置
  2. 将"调试基础库版本"设置为 **2.27.0 或更高版本**
  3. 取消勾选"使用灰度中的基础库"

### 3. 授权缓存问题
- **现象**：微信可能缓存了之前的授权结果
- **解决**：
  1. 在手机上：微信 → 设置 → 隐私 → 授权管理
  2. 找到你的小程序，点击"解除授权"
  3. 重新打开小程序，点击登录

### 4. 小程序未发布
- **现象**：未发布的小程序在某些情况下可能无法正常获取用户信息
- **解决**：确保小程序已经发布或使用体验版测试

## 测试步骤

### 方法 1：真机测试（推荐）

1. **清除小程序数据**
   - 在微信中长按小程序图标
   - 选择"设置" → "清除数据"

2. **清除授权缓存**
   - 微信 → 设置 → 隐私 → 授权管理
   - 找到你的小程序，点击"解除授权"

3. **重新打开小程序**
   - 扫码或搜索打开小程序
   - 点击"点击登录"按钮
   - 应该会弹出授权弹窗

4. **检查授权弹窗**
   - 应该显示"用于完善用户资料和身份识别"
   - 点击"允许"后，应该获取到你的真实微信昵称和头像

### 方法 2：检查基础库版本

1. **在开发者工具中**
   - 工具栏 → 详情 → 本地设置
   - 检查"调试基础库版本"
   - 建议使用 **2.27.0 或更高版本**

2. **在真机上**
   - 打开小程序后，点击右上角"..." → "关于"
   - 查看基础库版本

## 如果仍然没有弹窗

### 检查清单

- [ ] 是否在真机上测试（不是开发者工具）
- [ ] 基础库版本是否为 2.27.0 或更高
- [ ] 是否清除了小程序数据和授权缓存
- [ ] 是否在用户点击事件中直接调用（没有延迟）
- [ ] 小程序是否已发布或使用体验版

### 调试信息

如果仍然有问题，请提供：
1. 真机上的控制台日志（开启真机调试）
2. 基础库版本号
3. 微信版本号
4. 是否真的弹出了授权弹窗

## 注意事项

⚠️ **重要**：`wx.getUserProfile` 在开发者工具中可能不会弹出授权弹窗，这是正常现象。**必须在真机上测试登录功能**。

如果真机上也没有弹窗，可能是：
1. 基础库版本太低
2. 授权被缓存
3. 小程序未发布
