# 账号管理功能使用说明

## 📋 功能简介

账号管理功能让你可以安全地管理自己的登录状态，包括登录、退出登录、更换账号等操作。

## 🎯 主要功能

### 1. 用户登录
- 获取微信用户信息
- 生成唯一用户ID
- 保存登录状态

### 2. 我的二维码
- 生成专属二维码
- 供管理员扫码添加
- 基于唯一ID识别

### 3. 更换账号
- 清除当前用户信息
- 重新登录
- 重新获取权限

### 4. 退出登录
- 清除登录状态
- 保留其他数据
- 失去管理员权限

## 📍 功能入口

### 登录
```
方式1：首次进入
- 打开小程序时自动提示登录

方式2：点击头像
- 在"我的"页面点击"未登录"
- 点击"点击登录"按钮
```

### 我的二维码
```
1. 进入"我的"页面
2. 点击"📱 我的二维码"
3. 查看和分享二维码
```

### 更换账号
```
1. 进入"我的"页面
2. 滚动到底部
3. 点击"🔄 更换账号"
4. 确认操作
```

### 退出登录
```
1. 进入"我的"页面
2. 滚动到底部
3. 点击"🚪 退出登录"
4. 确认操作
```

## 🔐 登录流程

### 首次登录
```
1. 打开小程序
2. 系统提示"需要登录"
3. 点击"点击登录"
4. 授权获取微信信息
5. 系统生成唯一 userId
6. 登录成功
```

### 登录后获得
- ✅ 唯一用户ID（userId）
- ✅ 微信昵称和头像
- ✅ 登录时间记录
- ✅ 可生成专属二维码

## 🔄 更换账号流程

```
1. 点击"更换账号"
2. 系统提示："更换账号后需要重新获取权限"
3. 确认更换
4. 清除当前用户信息
5. 触发重新登录
6. 授权获取新账号信息
7. 生成新的 userId
8. 切换成功
```

### 注意事项
- ⚠️ 更换账号会失去当前的管理员权限
- ⚠️ 需要重新被添加为管理员
- ✅ 不会影响菜谱、订单等数据

## 🚪 退出登录流程

```
1. 点击"退出登录"
2. 系统提示："退出后将无法使用管理员功能"
3. 确认退出
4. 清除用户信息和 userId
5. 头像显示"未登录"
6. 失去管理员权限
```

### 退出后的状态
- ❌ 无法访问管理后台
- ❌ 无法使用管理员功能
- ❌ 无法生成二维码
- ✅ 仍可浏览菜谱
- ✅ 仍可下单（但建议登录）

## 💡 使用场景

### 场景1：共享设备
```
问题：多人使用同一台设备
解决：每人登录自己的账号
操作：使用"更换账号"功能
```

### 场景2：注销权限
```
问题：不再担任管理员
解决：退出登录清除身份
操作：使用"退出登录"功能
```

### 场景3：重新授权
```
问题：权限异常或信息错误
解决：重新登录刷新信息
操作：使用"更换账号"功能
```

### 场景4：隐私保护
```
问题：不想保留登录状态
解决：及时退出登录
操作：使用"退出登录"功能
```

## 🎨 界面说明

### 已登录状态
```
┌─────────────────────────┐
│ 👤 张三                 │
│    欢迎使用电子菜单      │
│    [👑 管理员]          │ (如果是管理员)
├─────────────────────────┤
│ 📱 我的二维码  >        │
│ 👑 管理后台  >          │ (仅管理员)
│ ...                     │
├─────────────────────────┤
│ 🔄 更换账号  >          │
│ 🚪 退出登录  >          │
└─────────────────────────┘
```

### 未登录状态
```
┌─────────────────────────┐
│ 👤 未登录               │
│    [点击登录]           │
├─────────────────────────┤
│ ⚙️ 店铺设置  >          │
│ 📤 导出数据  >          │
│ 📥 导入数据  >          │
│ 🗑️ 清空数据  >          │
└─────────────────────────┘
```

## 🔒 安全机制

### 用户标识
```
userId = "user_" + 时间戳 + "_" + 随机字符串

示例：user_1705555555555_abc123xyz
```

### 特点
- ✅ 唯一性：每个用户一个
- ✅ 不可变：生成后永久不变
- ✅ 本地存储：保存在设备上
- ✅ 可移植：可通过二维码传递

### 权限判断优先级
```
1. userId 匹配（最优先）
2. openid 匹配（如有后端）
3. nickName 匹配（兼容旧数据）
```

## ⚠️ 注意事项

### 1. 退出登录影响
- **失去管理员权限**：立即生效
- **无法编辑内容**：菜谱、分类等
- **无法处理订单**：接单、出餐等
- **可以浏览和下单**：基本功能保留

### 2. 更换账号影响
- **新账号重新开始**：生成新 userId
- **管理员权限不继承**：需重新添加
- **数据不受影响**：菜谱、订单保留

### 3. 数据保留
- ✅ 退出登录：保留所有菜谱、订单、分类
- ✅ 更换账号：保留所有菜谱、订单、分类
- ❌ 清空数据：删除所有内容

### 4. 管理员权限
- 退出登录后失去权限
- 更换账号后失去权限
- 需要重新被添加为管理员

## 💡 使用技巧

### 技巧1：临时使用他人设备
```
1. 登录自己的账号
2. 完成操作
3. 退出登录
4. 保护隐私
```

### 技巧2：权限交接
```
1. 旧管理员：添加新管理员
2. 验证新管理员权限
3. 旧管理员退出登录
4. 权限平稳过渡
```

### 技巧3：多设备使用
```
1. 每台设备都需要登录
2. 使用同一个微信账号
3. userId 自动同步
4. 权限保持一致
```

### 技巧4：定期检查
```
1. 定期查看管理员列表
2. 移除离职人员
3. 保持权限清单最新
```

## 📊 使用示例

### 示例1：正常退出

```
场景：下班后想退出登录

操作步骤：
1. 进入"我的"页面
2. 滚动到底部
3. 点击"退出登录"
4. 确认退出
5. 页面显示"未登录"状态

结果：
- 账号已退出
- 失去管理员权限
- 数据完整保留
```

### 示例2：更换账号

```
场景：另一个家人要使用

操作步骤：
1. 当前用户点击"更换账号"
2. 确认更换
3. 系统自动清除当前账号
4. 弹出登录授权
5. 新用户授权登录
6. 生成新 userId
7. 切换成功

结果：
- 新账号登录
- 原账号已退出
- 数据保留（共享）
```

### 示例3：重新登录

```
场景：退出后想重新登录

操作步骤：
1. 在"未登录"状态
2. 点击头像区域的"点击登录"
3. 授权获取信息
4. 登录成功

注意：
- 如果之前的 userId 还在设备上，会使用原ID
- 如果清除过，会生成新ID
```

## ❓ 常见问题

### Q1: 退出登录后数据会丢失吗？

**答案**：不会。
- 菜谱、订单、分类等数据完全保留
- 只是清除了登录状态
- 重新登录后可继续使用

### Q2: 更换账号和退出登录有什么区别？

**答案**：
- **更换账号**：退出后立即重新登录
- **退出登录**：只退出，不自动登录
- 两者都会清除用户信息

### Q3: 换了手机还能保留管理员权限吗？

**答案**：不能。
- userId 是设备本地生成的
- 换设备后会生成新 userId
- 需要重新被添加为管理员
- 未来可以通过后端 openid 解决

### Q4: 误退出了怎么办？

**答案**：
1. 点击"点击登录"重新登录
2. 如果有旧 userId，权限保留
3. 如果生成了新 userId，需重新添加

### Q5: 如何查看自己的 userId？

**答案**：
- 进入"我的二维码"页面
- 查看 ID 信息
- 可以复制保存

## 🔧 技术说明

### userId 生成规则
```javascript
userId = 'user_' + 时间戳 + '_' + 随机字符串

示例：
- user_1705555555555_abc123xyz
- user_1705555666666_def456uvw
```

### 数据清除范围

**退出登录/更换账号**：
- ✅ 清除：userInfo
- ✅ 清除：userId
- ✅ 清除：globalData.userInfo
- ✅ 清除：globalData.isAdmin
- ❌ 保留：菜谱数据
- ❌ 保留：订单数据
- ❌ 保留：分类数据
- ❌ 保留：店铺设置

**清空数据**：
- ✅ 清除：所有数据
- ✅ 重置：初始状态

## 🎉 总结

账号管理功能提供完善的用户体验：

- ✅ 安全的用户识别机制
- ✅ 灵活的账号切换
- ✅ 便捷的退出登录
- ✅ 完善的权限控制
- ✅ 数据安全保护

通过合理使用账号管理功能，可以在多人共享设备时保护隐私，同时确保权限管理的安全性！
