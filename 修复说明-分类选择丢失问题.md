# åˆ†ç±»é€‰æ‹©ä¸¢å¤±é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼š
- åœ¨"è‚‰è‚‰ç‚’èœ"åˆ†ç±»ä¸‹æŸ¥çœ‹èœè°±ï¼ˆç­›é€‰å‡º2ä¸ªï¼‰
- ç‚¹å‡»"æ·»åŠ èœè°±"ï¼Œæ·»åŠ æ–°èœè°±
- ä¿å­˜å¹¶è¿”å›å¨æˆ¿é¡µé¢
- **é—®é¢˜**ï¼šæ˜¾ç¤ºäº†æ‰€æœ‰6ä¸ªèœè°±ï¼Œè€Œä¸æ˜¯"è‚‰è‚‰ç‚’èœ"åˆ†ç±»çš„èœè°±
- åˆ†ç±»é€‰æ‹©è¢«é‡ç½®ä¸º"å…¨éƒ¨"

## ğŸ” é—®é¢˜åˆ†æ

ä»æ§åˆ¶å°æ—¥å¿—åˆ†æï¼š

```
# æ·»åŠ èœè°±å‰
selectedCategory: cat_002  â† ç”¨æˆ·é€‰æ‹©çš„"è‚‰è‚‰ç‚’èœ"
æŒ‰åˆ†ç±»ç­›é€‰å: 2  â† æ­£ç¡®ç­›é€‰

# æ·»åŠ èœè°±åè¿”å›
onShow è§¦å‘
  â†“
loadData() è¢«è°ƒç”¨
  â†“
setData({
  shopInfo: ...,
  currentKitchen: ...,
  categories: ...,
  recipes: ...,
  isAdmin: ...
  // âŒ æ²¡æœ‰åŒ…å« selectedCategoryï¼
})
  â†“
selectedCategory è¢«é‡ç½®ä¸ºåˆå§‹å€¼ 'all'
  â†“
filterRecipes() æ‰§è¡Œ
  â†“
selectedCategory: all  â† å·²ç»å˜æˆ"å…¨éƒ¨"
å¼€å§‹ç­›é€‰ï¼Œæ€»æ•°: 6
æœ€ç»ˆç­›é€‰ç»“æœ: 6  â† æ˜¾ç¤ºæ‰€æœ‰èœè°±
```

### é—®é¢˜æ ¹å› 

**setData è¦†ç›–äº†ç”¨æˆ·çŠ¶æ€**

```javascript
// âŒ é—®é¢˜ä»£ç 
this.setData({
  shopInfo: finalShopInfo,
  currentKitchen: finalCurrentKitchen,
  categories: categories,
  recipes: kitchenRecipes,
  isAdmin: app.checkIsAdmin()
  // ç¼ºå°‘ selectedCategoryï¼Œå¯¼è‡´è¢«é‡ç½®ä¸ºé»˜è®¤å€¼
});
```

åœ¨å°ç¨‹åºä¸­ï¼Œ`this.setData()` åªä¼šæ›´æ–°æŒ‡å®šçš„å­—æ®µï¼Œ**ä¸ä¼š**å½±å“å…¶ä»–å­—æ®µã€‚ä½†é—®é¢˜åœ¨äºï¼š
- `selectedCategory` çš„åˆå§‹å€¼å¯èƒ½åœ¨æŸå¤„è¢«è®¾ç½®
- æˆ–è€…é¡µé¢é‡æ–°æ¸²æŸ“æ—¶ä½¿ç”¨äº†åˆå§‹å€¼

## âœ… ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯

**ä¿æŒç”¨æˆ·çš„é€‰æ‹©çŠ¶æ€**ï¼š
1. æ›´æ–°æ•°æ®æ—¶ï¼Œä¸è¦†ç›– `selectedCategory`
2. åªåœ¨é¦–æ¬¡åŠ è½½æ—¶è®¾ç½®é»˜è®¤å€¼
3. ä¹‹åå§‹ç»ˆä¿æŒç”¨æˆ·çš„é€‰æ‹©

### ä¿®å¤ä»£ç 

#### ä¿®å¤ 1ï¼šloadData ä¸­ä¿æŒ selectedCategory

**ä¿®å¤å‰**ï¼š
```javascript
this.setData({
  shopInfo: finalShopInfo,
  currentKitchen: finalCurrentKitchen,
  categories: categories,
  recipes: kitchenRecipes,
  isAdmin: app.checkIsAdmin()
  // âŒ æ²¡æœ‰ selectedCategory
});
```

**ä¿®å¤å**ï¼š
```javascript
// æ„å»ºæ›´æ–°æ•°æ®å¯¹è±¡
const updateData = {
  shopInfo: finalShopInfo,
  currentKitchen: finalCurrentKitchen,
  categories: categories,
  recipes: kitchenRecipes,
  isAdmin: app.checkIsAdmin()
};

// â­ åªåœ¨é¦–æ¬¡åŠ è½½æ—¶è®¾ç½®é»˜è®¤å€¼
if (!this.data.selectedCategory) {
  updateData.selectedCategory = 'all';
}
// å¦åˆ™ä¿æŒç”¨æˆ·å½“å‰çš„é€‰æ‹©

this.setData(updateData, () => {
  console.log('å½“å‰åˆ†ç±»:', this.data.selectedCategory);
  this.filterRecipes();
});
```

#### ä¿®å¤ 2ï¼šonShow ä¸­ä¿æŒ selectedCategory

**ä¿®å¤å‰**ï¼š
```javascript
this.setData({
  recipes: kitchenRecipes
}, () => {
  this.filterRecipes();
});
```

**ä¿®å¤å**ï¼š
```javascript
console.log('ä¿æŒå½“å‰åˆ†ç±»:', this.data.selectedCategory);
this.setData({
  recipes: kitchenRecipes,
  categories: categories
  // â­ ä¸è®¾ç½® selectedCategoryï¼Œä¿æŒç”¨æˆ·é€‰æ‹©
}, () => {
  this.filterRecipes();  // ä½¿ç”¨ä¿æŒçš„ selectedCategory è¿›è¡Œç­›é€‰
});
```

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰ âŒ

```
ç”¨æˆ·åœ¨"è‚‰è‚‰ç‚’èœ"åˆ†ç±»
  â†“
selectedCategory = 'cat_002'
ç­›é€‰å‡º2ä¸ªèœè°±
  â†“
ç‚¹å‡»"æ·»åŠ èœè°±"
  â†“
è¿”å›é¡µé¢
  â†“
onShow â†’ loadData
  â†“
setData({ ... })  â† æ²¡æœ‰ selectedCategory
  â†“
selectedCategory è¢«é‡ç½®ä¸º 'all'
  â†“
âŒ æ˜¾ç¤ºæ‰€æœ‰èœè°±ï¼Œç”¨æˆ·é€‰æ‹©ä¸¢å¤±
```

### ä¿®å¤å âœ…

```
ç”¨æˆ·åœ¨"è‚‰è‚‰ç‚’èœ"åˆ†ç±»
  â†“
selectedCategory = 'cat_002'
ç­›é€‰å‡º2ä¸ªèœè°±
  â†“
ç‚¹å‡»"æ·»åŠ èœè°±"
  â†“
è¿”å›é¡µé¢
  â†“
onShow â†’ loadData
  â†“
setData({ ... })  â† ä¸åŒ…å« selectedCategory
  â†“
selectedCategory ä¿æŒä¸º 'cat_002'
  â†“
âœ… ä»ç„¶æ˜¾ç¤º"è‚‰è‚‰ç‚’èœ"åˆ†ç±»ï¼Œæ–°èœè°±æ­£ç¡®æ˜¾ç¤º
```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ¸…é™¤ç¼“å­˜å¹¶é‡æ–°ç¼–è¯‘
```
1. å¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ å·¥å…· â†’ æ¸…é™¤ â†’ å…¨éƒ¨æ¸…é™¤
2. ç‚¹å‡»"ç¼–è¯‘"æŒ‰é’®
```

### æ­¥éª¤ 2ï¼šå®Œæ•´æµ‹è¯•æµç¨‹

#### æµ‹è¯• Aï¼šåœ¨åˆ†ç±»ä¸­æ·»åŠ èœè°±

1. ç‚¹å‡»"è‚‰è‚‰ç‚’èœ"åˆ†ç±»ï¼ˆå‡è®¾æœ‰2ä¸ªèœè°±ï¼‰
2. ç¡®è®¤åªæ˜¾ç¤ºè¯¥åˆ†ç±»çš„2ä¸ªèœè°±
3. ç‚¹å‡»"æ·»åŠ èœè°±"
4. å¡«å†™ä¿¡æ¯ï¼Œé€‰æ‹©åˆ†ç±»ä¸º"è‚‰è‚‰ç‚’èœ"
5. ä¿å­˜å¹¶è¿”å›
6. **âœ… åº”è¯¥ä»ç„¶æ˜¾ç¤º"è‚‰è‚‰ç‚’èœ"åˆ†ç±»**
7. **âœ… åº”è¯¥æ˜¾ç¤º3ä¸ªèœè°±ï¼ˆåŸ2ä¸ª+æ–°1ä¸ªï¼‰**

#### æµ‹è¯• Bï¼šåœ¨åˆ†ç±»ä¸­ç¼–è¾‘èœè°±

1. ç‚¹å‡»"ç¡¬æ ¸è¤èœ"åˆ†ç±»
2. ç¡®è®¤åªæ˜¾ç¤ºè¯¥åˆ†ç±»çš„èœè°±
3. ç‚¹å‡»æŸä¸ªèœè°±ï¼Œè¿›å…¥ç¼–è¾‘
4. ä¿®æ”¹ä¿¡æ¯å¹¶ä¿å­˜
5. è¿”å›å¨æˆ¿é¡µé¢
6. **âœ… åº”è¯¥ä»ç„¶åœ¨"ç¡¬æ ¸è¤èœ"åˆ†ç±»**
7. **âœ… æ˜¾ç¤ºè¯¥åˆ†ç±»çš„æ‰€æœ‰èœè°±**

#### æµ‹è¯• Cï¼šåˆ‡æ¢åˆ†ç±»åæ·»åŠ èœè°±

1. åœ¨"å…¨éƒ¨"åˆ†ç±»ä¸‹
2. ç‚¹å‡»åˆ‡æ¢åˆ°"ç”°å›­æ—¶è”¬"
3. ç‚¹å‡»"æ·»åŠ èœè°±"
4. æ·»åŠ ä¸€ä¸ª"ç”°å›­æ—¶è”¬"çš„èœè°±
5. è¿”å›
6. **âœ… åº”è¯¥ä»ç„¶åœ¨"ç”°å›­æ—¶è”¬"åˆ†ç±»**
7. **âœ… æ˜¾ç¤ºæ–°æ·»åŠ çš„èœè°±**

### æ­¥éª¤ 3ï¼šéªŒè¯æ§åˆ¶å°æ—¥å¿—

**âœ… æ­£ç¡®çš„æ—¥å¿—åº”è¯¥ï¼š**
```
# ç”¨æˆ·é€‰æ‹©åˆ†ç±»
selectedCategory: cat_002

# æ·»åŠ èœè°±åè¿”å›
onShow å¼€å§‹
æ£€æµ‹åˆ°èœè°±æ•°é‡å˜åŒ–ï¼Œæ›´æ–°æ•°æ®
ä¿æŒå½“å‰åˆ†ç±»: cat_002  â† å…³é”®ï¼šä¿æŒäº†é€‰æ‹©

# ç­›é€‰
filterRecipes å¼€å§‹
selectedCategory: cat_002  â† ä»ç„¶æ˜¯ç”¨æˆ·é€‰æ‹©çš„åˆ†ç±»
å¼€å§‹ç­›é€‰ï¼Œæ€»æ•°: 6
æŒ‰åˆ†ç±»ç­›é€‰å: 3  â† æ­£ç¡®ç­›é€‰å‡ºè¯¥åˆ†ç±»çš„èœè°±
```

## ğŸ“ é¢„æœŸç»“æœ

**âœ… æˆåŠŸçš„æ ‡å¿—ï¼š**

1. **åˆ†ç±»é€‰æ‹©ä¿æŒ**ï¼š
   - åœ¨ä»»ä½•åˆ†ç±»ä¸‹æ·»åŠ èœè°±
   - è¿”å›åä»ç„¶åœ¨è¯¥åˆ†ç±»
   - ä¸ä¼šè·³å›"å…¨éƒ¨"

2. **ç­›é€‰æ­£ç¡®**ï¼š
   - æ˜¾ç¤ºå½“å‰åˆ†ç±»çš„æ‰€æœ‰èœè°±
   - åŒ…æ‹¬æ–°æ·»åŠ çš„èœè°±
   - æ•°é‡æ­£ç¡®

3. **ç”¨æˆ·ä½“éªŒ**ï¼š
   - æ“ä½œæµç•…ï¼Œç¬¦åˆé¢„æœŸ
   - ä¸ä¼šæ„Ÿåˆ°çªå…€
   - çŠ¶æ€ä¿æŒä¸€è‡´

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### 1. setData çš„éƒ¨åˆ†æ›´æ–°ç‰¹æ€§

```javascript
// å°ç¨‹åºçš„ setData æ˜¯éƒ¨åˆ†æ›´æ–°
this.data = {
  selectedCategory: 'cat_002',
  recipes: [...]
};

// åªæ›´æ–° recipes
this.setData({
  recipes: newRecipes
});

// ç»“æœï¼šselectedCategory ä¿æŒä¸å˜ âœ…
console.log(this.data.selectedCategory);  // 'cat_002'
```

### 2. çŠ¶æ€ä¿æŒç­–ç•¥

**æ–¹æ³• 1ï¼šä¸è®¾ç½®ï¼ˆæ¨èï¼‰**
```javascript
// âœ… ä¸åœ¨ setData ä¸­åŒ…å« selectedCategory
this.setData({
  recipes: newRecipes
  // selectedCategory è‡ªåŠ¨ä¿æŒ
});
```

**æ–¹æ³• 2ï¼šæ˜¾å¼ä¿æŒ**
```javascript
// âœ… æ˜¾å¼ä½¿ç”¨å½“å‰å€¼
this.setData({
  recipes: newRecipes,
  selectedCategory: this.data.selectedCategory
});
```

**æ–¹æ³• 3ï¼šæ¡ä»¶è®¾ç½®**
```javascript
// âœ… åªåœ¨éœ€è¦æ—¶è®¾ç½®
const updateData = { recipes: newRecipes };
if (!this.data.selectedCategory) {
  updateData.selectedCategory = 'all';
}
this.setData(updateData);
```

### 3. åˆå§‹åŒ– vs æ›´æ–°

```javascript
// åˆå§‹åŒ–ï¼ˆonLoadï¼‰- è®¾ç½®æ‰€æœ‰åˆå§‹å€¼
onLoad() {
  this.setData({
    selectedCategory: 'all',  // è®¾ç½®é»˜è®¤å€¼
    recipes: [],
    // ...
  });
}

// æ›´æ–°ï¼ˆonShow/loadDataï¼‰- åªæ›´æ–°å¿…è¦å­—æ®µ
onShow() {
  this.setData({
    recipes: newRecipes  // åªæ›´æ–°æ•°æ®
    // ä¸è®¾ç½® selectedCategoryï¼Œä¿æŒç”¨æˆ·é€‰æ‹©
  });
}
```

### 4. æ—¥å¿—è¾…åŠ©è°ƒè¯•

```javascript
this.setData(updateData, () => {
  console.log('æ›´æ–°åçš„åˆ†ç±»:', this.data.selectedCategory);
  console.log('recipesæ•°é‡:', this.data.recipes.length);
  this.filterRecipes();
});
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é¡µé¢çŠ¶æ€ç®¡ç†åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡µé¢çŠ¶æ€åˆ†ç±»                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æ•°æ®çŠ¶æ€ï¼ˆéœ€è¦æ›´æ–°ï¼‰         â”‚
â”‚     - recipes                   â”‚
â”‚     - categories                â”‚
â”‚     - shopInfo                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. UIçŠ¶æ€ï¼ˆéœ€è¦ä¿æŒï¼‰           â”‚
â”‚     - selectedCategory          â”‚
â”‚     - searchKeyword             â”‚
â”‚     - showSearch                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. è®¡ç®—çŠ¶æ€ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰         â”‚
â”‚     - filteredRecipes           â”‚
â”‚     - cartCount                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ›´æ–°ç­–ç•¥

**æ•°æ®çŠ¶æ€**ï¼šéœ€è¦åŒæ­¥
```javascript
loadData() {
  this.setData({
    recipes: newRecipes,  // æ›´æ–°æ•°æ®
    categories: newCategories
  });
}
```

**UIçŠ¶æ€**ï¼šéœ€è¦ä¿æŒ
```javascript
loadData() {
  // ä¸è¦è®¾ç½®è¿™äº›å­—æ®µï¼Œè®©å®ƒä»¬ä¿æŒç”¨æˆ·çš„é€‰æ‹©
  // selectedCategory âœ…
  // searchKeyword âœ…
  // showSearch âœ…
}
```

**è®¡ç®—çŠ¶æ€**ï¼šé‡æ–°è®¡ç®—
```javascript
loadData() {
  this.setData({ recipes: newRecipes }, () => {
    this.filterRecipes();  // é‡æ–°è®¡ç®— filteredRecipes
    this.updateCartCount();  // é‡æ–°è®¡ç®— cartCount
  });
}
```

### 3. å®Œæ•´çš„æ•°æ®æ›´æ–°æµç¨‹

```javascript
loadData() {
  // 1. è·å–æ–°æ•°æ®
  const newRecipes = wx.getStorageSync('recipes');
  
  // 2. æ„å»ºæ›´æ–°å¯¹è±¡ï¼ˆåªåŒ…å«æ•°æ®çŠ¶æ€ï¼‰
  const updateData = {
    recipes: newRecipes,
    categories: newCategories
  };
  
  // 3. é¦–æ¬¡åŠ è½½æ—¶è®¾ç½®UIçŠ¶æ€é»˜è®¤å€¼
  if (!this.data.selectedCategory) {
    updateData.selectedCategory = 'all';
    updateData.searchKeyword = '';
    updateData.showSearch = false;
  }
  
  // 4. æ›´æ–°æ•°æ®
  this.setData(updateData, () => {
    // 5. é‡æ–°è®¡ç®—æ´¾ç”ŸçŠ¶æ€
    this.filterRecipes();
    this.updateCartCount();
  });
}
```

## ğŸš€ æ‰©å±•ä¼˜åŒ–

### 1. çŠ¶æ€æŒä¹…åŒ–

å¦‚æœå¸Œæœ›å³ä½¿å…³é—­å°ç¨‹åºä¹Ÿä¿æŒåˆ†ç±»é€‰æ‹©ï¼š

```javascript
// ä¿å­˜çŠ¶æ€
selectCategory(e) {
  const categoryId = e.currentTarget.dataset.id;
  this.setData({ selectedCategory: categoryId });
  wx.setStorageSync('lastCategory', categoryId);
  this.filterRecipes();
}

// æ¢å¤çŠ¶æ€
onLoad() {
  const lastCategory = wx.getStorageSync('lastCategory') || 'all';
  this.setData({ selectedCategory: lastCategory });
}
```

### 2. çŠ¶æ€ç®¡ç†å™¨

å¯¹äºå¤æ‚åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨çŠ¶æ€ç®¡ç†ï¼š

```javascript
// state-manager.js
class StateManager {
  constructor() {
    this.state = {
      data: {},      // æ•°æ®çŠ¶æ€
      ui: {},        // UIçŠ¶æ€
      computed: {}   // è®¡ç®—çŠ¶æ€
    };
  }
  
  updateData(newData) {
    this.state.data = Object.assign({}, this.state.data, newData);
    // ä¸å½±å“ UI çŠ¶æ€
  }
  
  updateUI(newUI) {
    this.state.ui = Object.assign({}, this.state.ui, newUI);
  }
  
  getState() {
    return Object.assign({}, this.state.data, this.state.ui, this.state.computed);
  }
}
```

### 3. è·¯ç”±å‚æ•°ä¼ é€’

å¦ä¸€ç§æ–¹æ¡ˆæ˜¯é€šè¿‡è·¯ç”±å‚æ•°ä¿æŒçŠ¶æ€ï¼š

```javascript
// æ·»åŠ èœè°±æ—¶ä¼ é€’å½“å‰åˆ†ç±»
addRecipe() {
  wx.navigateTo({
    url: `/pages/recipe/add/add?returnCategory=${this.data.selectedCategory}`
  });
}

// è¿”å›æ—¶æ¢å¤
onShow() {
  const pages = getCurrentPages();
  const prevPage = pages[pages.length - 2];
  if (prevPage && prevPage.options.returnCategory) {
    this.setData({ selectedCategory: prevPage.options.returnCategory });
  }
}
```

## âœ¨ æ€»ç»“

**é—®é¢˜åŸå› **ï¼š
- loadData ä¸­ setData æ²¡æœ‰ä¿ç•™ selectedCategory
- å¯¼è‡´ç”¨æˆ·çš„åˆ†ç±»é€‰æ‹©è¢«é‡ç½®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åŒºåˆ†æ•°æ®çŠ¶æ€å’ŒUIçŠ¶æ€
- æ›´æ–°æ•°æ®æ—¶ä¸è¦†ç›–UIçŠ¶æ€
- åªåœ¨é¦–æ¬¡åŠ è½½æ—¶è®¾ç½®é»˜è®¤å€¼

**ä¿®å¤æ•ˆæœ**ï¼š
- âœ… åˆ†ç±»é€‰æ‹©ä¿æŒä¸å˜
- âœ… æ·»åŠ èœè°±åä»åœ¨å½“å‰åˆ†ç±»
- âœ… ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… ç”¨æˆ·ä½“éªŒæµç•…

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2026-01-18  
**ä¿®å¤æ–¹æ³•**ï¼šä¿æŒUIçŠ¶æ€ä¸è¢«è¦†ç›–  
**æµ‹è¯•çŠ¶æ€**ï¼šå¾…éªŒè¯
